(()=>{var le=Object.create;var bt=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var rt=(u,t)=>()=>(t||u((t={exports:{}}).exports,t),t.exports);var ve=(u,t,e,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of pe(t))!ge.call(u,p)&&p!==e&&bt(u,p,{get:()=>t[p],enumerable:!(c=fe(t,p))||c.enumerable});return u};var Et=(u,t,e)=>(e=u!=null?le(de(u)):{},ve(t||!u||!u.__esModule?bt(e,"default",{value:u,enumerable:!0}):e,u));var Ct=rt((ze,pt)=>{(function(u,t){"use strict";var e=function(l,n){return new e.Instance(l,n||{})};e.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},e.HAS_POINTEREVENTS=u.navigator.pointerEnabled||u.navigator.msPointerEnabled,e.HAS_TOUCHEVENTS="ontouchstart"in u,e.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,e.NO_MOUSEEVENTS=e.HAS_TOUCHEVENTS&&u.navigator.userAgent.match(e.MOBILE_REGEX),e.EVENT_TYPES={},e.DIRECTION_DOWN="down",e.DIRECTION_LEFT="left",e.DIRECTION_UP="up",e.DIRECTION_RIGHT="right",e.POINTER_MOUSE="mouse",e.POINTER_TOUCH="touch",e.POINTER_PEN="pen",e.UPDATE_VELOCITY_INTERVAL=20,e.EVENT_START="start",e.EVENT_MOVE="move",e.EVENT_END="end",e.DOCUMENT=u.document,e.plugins=e.plugins||{},e.gestures=e.gestures||{},e.READY=!1;function c(){e.READY||(e.event.determineEventTypes(),e.utils.each(e.gestures,function(l){e.detection.register(l)}),e.event.onTouch(e.DOCUMENT,e.EVENT_MOVE,e.detection.detect),e.event.onTouch(e.DOCUMENT,e.EVENT_END,e.detection.detect),e.READY=!0)}e.utils={extend:function(n,s,f){for(var v in s)n[v]!==t&&f||(n[v]=s[v]);return n},each:function(l,n,s){var f,v;if("forEach"in l)l.forEach(n,s);else if(l.length!==t){for(f=0,v=l.length;f<v;f++)if(n.call(s,l[f],f,l)===!1)return}else for(f in l)if(l.hasOwnProperty(f)&&n.call(s,l[f],f,l)===!1)return},hasParent:function(l,n){for(;l;){if(l==n)return!0;l=l.parentNode}return!1},getCenter:function(n){var s=[],f=[];return e.utils.each(n,function(v){s.push(typeof v.clientX<"u"?v.clientX:v.pageX),f.push(typeof v.clientY<"u"?v.clientY:v.pageY)}),{pageX:(Math.min.apply(Math,s)+Math.max.apply(Math,s))/2,pageY:(Math.min.apply(Math,f)+Math.max.apply(Math,f))/2}},getVelocity:function(n,s,f){return{x:Math.abs(s/n)||0,y:Math.abs(f/n)||0}},getAngle:function(n,s){var f=s.pageY-n.pageY,v=s.pageX-n.pageX;return Math.atan2(f,v)*180/Math.PI},getDirection:function(n,s){var f=Math.abs(n.pageX-s.pageX),v=Math.abs(n.pageY-s.pageY);return f>=v?n.pageX-s.pageX>0?e.DIRECTION_LEFT:e.DIRECTION_RIGHT:n.pageY-s.pageY>0?e.DIRECTION_UP:e.DIRECTION_DOWN},getDistance:function(n,s){var f=s.pageX-n.pageX,v=s.pageY-n.pageY;return Math.sqrt(f*f+v*v)},getScale:function(n,s){return n.length>=2&&s.length>=2?this.getDistance(s[0],s[1])/this.getDistance(n[0],n[1]):1},getRotation:function(n,s){return n.length>=2&&s.length>=2?this.getAngle(s[1],s[0])-this.getAngle(n[1],n[0]):0},isVertical:function(n){return n==e.DIRECTION_UP||n==e.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(n,s){!s||!n||!n.style||(e.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(f){e.utils.each(s,function(v,O){f&&(O=f+O.substring(0,1).toUpperCase()+O.substring(1)),O in n.style&&(n.style[O]=v)})}),s.userSelect=="none"&&(n.onselectstart=function(){return!1}),s.userDrag=="none"&&(n.ondragstart=function(){return!1}))},startDefaultBrowserBehavior:function(n,s){!s||!n||!n.style||(e.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(f){e.utils.each(s,function(v,O){f&&(O=f+O.substring(0,1).toUpperCase()+O.substring(1)),O in n.style&&(n.style[O]="")})}),s.userSelect=="none"&&(n.onselectstart=null),s.userDrag=="none"&&(n.ondragstart=null))}},e.Instance=function(l,n){var s=this;return c(),this.element=l,this.enabled=!0,this.options=e.utils.extend(e.utils.extend({},e.defaults),n||{}),this.options.stop_browser_behavior&&e.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),this._eventStartHandler=e.event.onTouch(l,e.EVENT_START,function(f){s.enabled&&e.detection.startDetect(s,f)}),this._eventHandler=[],this},e.Instance.prototype={on:function(n,s){var f=n.split(" ");return e.utils.each(f,function(v){this.element.addEventListener(v,s,!1),this._eventHandler.push({gesture:v,handler:s})},this),this},off:function(n,s){var f=n.split(" ");return e.utils.each(f,function(v){this.element.removeEventListener(v,s,!1);var O=-1;e.utils.each(this._eventHandler,function(A,C){O===-1&&A.gesture===v&&A.handler===s&&(O=C)},this),O>-1&&this._eventHandler.splice(O,1)},this),this},trigger:function(n,s){s||(s={});var f=e.DOCUMENT.createEvent("Event");f.initEvent(n,!0,!0),f.gesture=s;var v=this.element;return e.utils.hasParent(s.target,v)&&(v=s.target),v.dispatchEvent(f),this},enable:function(n){return this.enabled=n,this},dispose:function(){return this.options.stop_browser_behavior&&e.utils.startDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),e.utils.each(this._eventHandler,function(n){this.element.removeEventListener(n.gesture,n.handler,!1)},this),this._eventHandler.length=0,e.event.unbindDom(this.element,e.EVENT_TYPES[e.EVENT_START],this._eventStartHandler),this}};var p=null,T=!1,m=!1;e.event={bindDom:function(l,n,s){var f=n.split(" ");e.utils.each(f,function(v){l.addEventListener(v,s,!1)})},unbindDom:function(l,n,s){var f=n.split(" ");e.utils.each(f,function(v){l.removeEventListener(v,s,!1)})},onTouch:function(n,s,f){var v=this,O=function(C){var L=C.type.toLowerCase();if(!(L.match(/mouse/)&&m)){L.match(/touch/)||L.match(/pointerdown/)||L.match(/mouse/)&&C.which===1?T=!0:L.match(/mouse/)&&!C.which&&(T=!1),L.match(/touch|pointer/)&&(m=!0);var N=0;T&&(e.HAS_POINTEREVENTS&&s!=e.EVENT_END?N=e.PointerEvent.updatePointer(s,C):L.match(/touch/)?N=C.touches.length:m||(N=L.match(/up/)?0:1),N>0&&s==e.EVENT_END?s=e.EVENT_MOVE:N||(s=e.EVENT_END),(N||p===null)&&(p=C),f.call(e.detection,v.collectEventData(n,s,v.getTouchList(p,s),C)),e.HAS_POINTEREVENTS&&s==e.EVENT_END&&(N=e.PointerEvent.updatePointer(s,C))),N||(p=null,T=!1,m=!1,e.PointerEvent.reset())}};return this.bindDom(n,e.EVENT_TYPES[s],O),O},determineEventTypes:function(){var n;e.HAS_POINTEREVENTS?n=e.PointerEvent.getEvents():e.NO_MOUSEEVENTS?n=["touchstart","touchmove","touchend touchcancel"]:n=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],e.EVENT_TYPES[e.EVENT_START]=n[0],e.EVENT_TYPES[e.EVENT_MOVE]=n[1],e.EVENT_TYPES[e.EVENT_END]=n[2]},getTouchList:function(n){return e.HAS_POINTEREVENTS?e.PointerEvent.getTouchList():n.touches?n.touches:(n.identifier=1,[n])},collectEventData:function(n,s,f,v){var O=e.POINTER_TOUCH;return(v.type.match(/mouse/)||e.PointerEvent.matchType(e.POINTER_MOUSE,v))&&(O=e.POINTER_MOUSE),{center:e.utils.getCenter(f),timeStamp:new Date().getTime(),target:v.target,touches:f,eventType:s,pointerType:O,srcEvent:v,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return e.detection.stopDetect()}}}},e.PointerEvent={pointers:{},getTouchList:function(){var l=this,n=[];return e.utils.each(l.pointers,function(s){n.push(s)}),n},updatePointer:function(l,n){return l==e.EVENT_END?delete this.pointers[n.pointerId]:(n.identifier=n.pointerId,this.pointers[n.pointerId]=n),Object.keys(this.pointers).length},matchType:function(l,n){if(!n.pointerType)return!1;var s=n.pointerType,f={};return f[e.POINTER_MOUSE]=s===n.MSPOINTER_TYPE_MOUSE||s===e.POINTER_MOUSE,f[e.POINTER_TOUCH]=s===n.MSPOINTER_TYPE_TOUCH||s===e.POINTER_TOUCH,f[e.POINTER_PEN]=s===n.MSPOINTER_TYPE_PEN||s===e.POINTER_PEN,f[l]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},e.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(n,s){this.current||(this.stopped=!1,this.current={inst:n,startEvent:e.utils.extend({},s),lastEvent:!1,lastVEvent:!1,velocity:!1,name:""},this.detect(s))},detect:function(n){if(!(!this.current||this.stopped)){n=this.extendEventData(n);var s=this.current.inst.options;return e.utils.each(this.gestures,function(f){if(!this.stopped&&s[f.name]!==!1&&f.handler.call(f,n,this.current.inst)===!1)return this.stopDetect(),!1},this),this.current&&(this.current.lastEvent=n),n.eventType==e.EVENT_END&&!n.touches.length-1&&this.stopDetect(),n}},stopDetect:function(){this.previous=e.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(n){var s=this.current.startEvent,f=this.current.lastVEvent;s&&(n.touches.length!=s.touches.length||n.touches===s.touches)&&(s.touches=[],e.utils.each(n.touches,function($){s.touches.push(e.utils.extend({},$))}));var v=n.timeStamp-s.timeStamp,O=n.center.pageX-s.center.pageX,A=n.center.pageY-s.center.pageY,C,L,N=this.current.velocity;return f!==!1&&n.timeStamp-f.timeStamp>e.UPDATE_VELOCITY_INTERVAL?(N=e.utils.getVelocity(n.timeStamp-f.timeStamp,n.center.pageX-f.center.pageX,n.center.pageY-f.center.pageY),this.current.lastVEvent=n,N.x>0&&N.y>0&&(this.current.velocity=N)):this.current.velocity===!1&&(N=e.utils.getVelocity(v,O,A),this.current.velocity=N,this.current.lastVEvent=n),n.eventType==="end"?(C=this.current.lastEvent&&this.current.lastEvent.interimAngle,L=this.current.lastEvent&&this.current.lastEvent.interimDirection):(C=this.current.lastEvent&&e.utils.getAngle(this.current.lastEvent.center,n.center),L=this.current.lastEvent&&e.utils.getDirection(this.current.lastEvent.center,n.center)),e.utils.extend(n,{deltaTime:v,deltaX:O,deltaY:A,velocityX:N.x,velocityY:N.y,distance:e.utils.getDistance(s.center,n.center),angle:e.utils.getAngle(s.center,n.center),interimAngle:C,direction:e.utils.getDirection(s.center,n.center),interimDirection:L,scale:e.utils.getScale(s.touches,n.touches),rotation:e.utils.getRotation(s.touches,n.touches),startEvent:s}),n},register:function(n){var s=n.defaults||{};return s[n.name]===t&&(s[n.name]=!0),e.utils.extend(e.defaults,s,!0),n.index=n.index||1e3,this.gestures.push(n),this.gestures.sort(function(f,v){return f.index<v.index?-1:f.index>v.index?1:0}),this.gestures}},e.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(n,s){if(e.detection.current.name!=this.name&&this.triggered){s.trigger(this.name+"end",n),this.triggered=!1;return}if(!(s.options.drag_max_touches>0&&n.touches.length>s.options.drag_max_touches))switch(n.eventType){case e.EVENT_START:this.triggered=!1;break;case e.EVENT_MOVE:if(n.distance<s.options.drag_min_distance&&e.detection.current.name!=this.name)return;if(e.detection.current.name!=this.name&&(e.detection.current.name=this.name,s.options.correct_for_drag_min_distance&&n.distance>0)){var f=Math.abs(s.options.drag_min_distance/n.distance);e.detection.current.startEvent.center.pageX+=n.deltaX*f,e.detection.current.startEvent.center.pageY+=n.deltaY*f,n=e.detection.extendEventData(n)}(e.detection.current.lastEvent.drag_locked_to_axis||s.options.drag_lock_to_axis&&s.options.drag_lock_min_distance<=n.distance)&&(n.drag_locked_to_axis=!0);var v=e.detection.current.lastEvent.direction;n.drag_locked_to_axis&&v!==n.direction&&(e.utils.isVertical(v)?n.direction=n.deltaY<0?e.DIRECTION_UP:e.DIRECTION_DOWN:n.direction=n.deltaX<0?e.DIRECTION_LEFT:e.DIRECTION_RIGHT),this.triggered||(s.trigger(this.name+"start",n),this.triggered=!0),s.trigger(this.name,n),s.trigger(this.name+n.direction,n),(s.options.drag_block_vertical&&e.utils.isVertical(n.direction)||s.options.drag_block_horizontal&&!e.utils.isVertical(n.direction))&&n.preventDefault();break;case e.EVENT_END:this.triggered&&s.trigger(this.name+"end",n),this.triggered=!1;break}}},e.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(n,s){switch(n.eventType){case e.EVENT_START:clearTimeout(this.timer),e.detection.current.name=this.name,this.timer=setTimeout(function(){e.detection.current.name=="hold"&&s.trigger("hold",n)},s.options.hold_timeout);break;case e.EVENT_MOVE:n.distance>s.options.hold_threshold&&clearTimeout(this.timer);break;case e.EVENT_END:clearTimeout(this.timer);break}}},e.gestures.Release={name:"release",index:1/0,handler:function(n,s){n.eventType==e.EVENT_END&&s.trigger(this.name,n)}},e.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(n,s){if(n.eventType==e.EVENT_END){if(s.options.swipe_max_touches>0&&n.touches.length<s.options.swipe_min_touches&&n.touches.length>s.options.swipe_max_touches)return;(n.velocityX>s.options.swipe_velocity||n.velocityY>s.options.swipe_velocity)&&(s.trigger(this.name,n),s.trigger(this.name+n.direction,n))}}},e.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(n,s){if(n.eventType==e.EVENT_MOVE&&!e.detection.current.reachedTapMaxDistance)e.detection.current.reachedTapMaxDistance=n.distance>s.options.tap_max_distance;else if(n.eventType==e.EVENT_END&&n.srcEvent.type!="touchcancel"){var f=e.detection.previous,v=!1;if(e.detection.current.reachedTapMaxDistance||n.deltaTime>s.options.tap_max_touchtime)return;f&&f.name=="tap"&&n.timeStamp-f.lastEvent.timeStamp<s.options.doubletap_interval&&n.distance<s.options.doubletap_distance&&(s.trigger("doubletap",n),v=!0),(!v||s.options.tap_always)&&(e.detection.current.name="tap",s.trigger(e.detection.current.name,n))}}},e.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(n,s){if(s.options.prevent_mouseevents&&n.pointerType==e.POINTER_MOUSE){n.stopDetect();return}s.options.prevent_default&&n.preventDefault(),n.eventType==e.EVENT_START&&s.trigger(this.name,n)}},e.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(n,s){if(e.detection.current.name!=this.name&&this.triggered){s.trigger(this.name+"end",n),this.triggered=!1;return}if(!(n.touches.length<2))switch(s.options.transform_always_block&&n.preventDefault(),n.eventType){case e.EVENT_START:this.triggered=!1;break;case e.EVENT_MOVE:var f=Math.abs(1-n.scale),v=Math.abs(n.rotation);if(f<s.options.transform_min_scale&&v<s.options.transform_min_rotation)return;e.detection.current.name=this.name,this.triggered||(s.trigger(this.name+"start",n),this.triggered=!0),s.trigger(this.name,n),v>s.options.transform_min_rotation&&s.trigger("rotate",n),f>s.options.transform_min_scale&&(s.trigger("pinch",n),s.trigger("pinch"+(n.scale<1?"in":"out"),n));break;case e.EVENT_END:this.triggered&&s.trigger(this.name+"end",n),this.triggered=!1;break}}},typeof define=="function"&&define.amd?define(function(){return e}):typeof pt=="object"&&pt.exports?pt.exports=e:u.Hammer=e})(window)});var Lt=rt((Ze,dt)=>{(function(){for(var u={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={option:"alt",command:"meta",return:"enter",escape:"esc"},p,T={},m={},l={},n,s=!1,f=!1,v=1;v<20;++v)u[111+v]="f"+v;for(v=0;v<=9;++v)u[v+96]=v;function O(g,E,S){if(g.addEventListener){g.addEventListener(E,S,!1);return}g.attachEvent("on"+E,S)}function A(g){return g.type=="keypress"?String.fromCharCode(g.which):u[g.which]?u[g.which]:t[g.which]?t[g.which]:String.fromCharCode(g.which).toLowerCase()}function C(g,E){return g.sort().join(",")===E.sort().join(",")}function L(g){g=g||{};var E=!1,S;for(S in l){if(g[S]){E=!0;continue}l[S]=0}E||(f=!1)}function N(g,E,S,P,V){var B,R,I=[],X=S.type;if(!T[g])return[];for(X=="keyup"&&z(g)&&(E=[g]),B=0;B<T[g].length;++B)R=T[g][B],!(R.seq&&l[R.seq]!=R.level)&&X==R.action&&(X=="keypress"&&!S.metaKey&&!S.ctrlKey||C(E,R.modifiers))&&(P&&R.combo==V&&T[g].splice(B,1),I.push(R));return I}function $(g){var E=[];return g.shiftKey&&E.push("shift"),g.altKey&&E.push("alt"),g.ctrlKey&&E.push("ctrl"),g.metaKey&&E.push("meta"),E}function q(g,E){g(E)===!1&&(E.preventDefault&&E.preventDefault(),E.stopPropagation&&E.stopPropagation(),E.returnValue=!1,E.cancelBubble=!0)}function lt(g,E){if(!G.stopCallback(E,E.target||E.srcElement)){var S=N(g,$(E),E),P,V={},B=!1;for(P=0;P<S.length;++P){if(S[P].seq){B=!0,V[S[P].seq]=1,q(S[P].callback,E);continue}!B&&!f&&q(S[P].callback,E)}E.type==f&&!z(g)&&L(V)}}function tt(g){g.which=typeof g.which=="number"?g.which:g.keyCode;var E=A(g);if(E){if(g.type=="keyup"&&s==E){s=!1;return}lt(E,g)}}function z(g){return g=="shift"||g=="ctrl"||g=="alt"||g=="meta"}function et(){clearTimeout(n),n=setTimeout(L,1e3)}function a(){if(!p){p={};for(var g in u)g>95&&g<112||u.hasOwnProperty(g)&&(p[u[g]]=g)}return p}function x(g,E,S){return S||(S=a()[g]?"keydown":"keypress"),S=="keypress"&&E.length&&(S="keydown"),S}function ft(g,E,S,P){l[g]=0,P||(P=x(E[0],[]));var V=function(I){f=P,++l[g],et()},B=function(I){q(S,I),P!=="keyup"&&(s=A(I)),setTimeout(L,10)},R;for(R=0;R<E.length;++R)it(E[R],R<E.length-1?V:B,P,g,R)}function it(g,E,S,P,V){g=g.replace(/\s+/g," ");var B=g.split(" "),R,I,X,F=[];if(B.length>1){ft(g,B,E,S);return}for(X=g==="+"?["+"]:g.split("+"),R=0;R<X.length;++R)I=X[R],c[I]&&(I=c[I]),S&&S!="keypress"&&e[I]&&(I=e[I],F.push("shift")),z(I)&&F.push(I);S=x(I,F,S),T[I]||(T[I]=[]),N(I,F,{type:S},!P,g),T[I][P?"unshift":"push"]({callback:E,modifiers:F,action:S,seq:P,level:V,combo:g})}function nt(g,E,S){for(var P=0;P<g.length;++P)it(g[P],E,S)}O(document,"keypress",tt),O(document,"keydown",tt),O(document,"keyup",tt);var G={bind:function(g,E,S){return nt(g instanceof Array?g:[g],E,S),m[g+":"+S]=E,this},unbind:function(g,E){return m[g+":"+E]&&(delete m[g+":"+E],this.bind(g,function(){},E)),this},trigger:function(g,E){return m[g+":"+E](),this},reset:function(){return T={},m={},this},stopCallback:function(g,E){return(" "+E.className+" ").indexOf(" mousetrap ")>-1?!1:E.tagName=="INPUT"||E.tagName=="SELECT"||E.tagName=="TEXTAREA"||E.contentEditable&&E.contentEditable=="true"}};window.Mousetrap=G,typeof define=="function"&&define.amd&&define("mousetrap",function(){return G}),typeof dt=="object"&&dt.exports&&(dt.exports=G)})()});var ee=rt((vi,Dt)=>{"use strict";var Q=typeof Reflect=="object"?Reflect:null,Kt=Q&&typeof Q.apply=="function"?Q.apply:function(t,e,c){return Function.prototype.apply.call(t,e,c)},gt;Q&&typeof Q.ownKeys=="function"?gt=Q.ownKeys:Object.getOwnPropertySymbols?gt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:gt=function(t){return Object.getOwnPropertyNames(t)};function Ie(u){console&&console.warn&&console.warn(u)}var Gt=Number.isNaN||function(t){return t!==t};function D(){D.init.call(this)}Dt.exports=D;Dt.exports.once=Be;D.EventEmitter=D;D.prototype._events=void 0;D.prototype._eventsCount=0;D.prototype._maxListeners=void 0;var qt=10;function vt(u){if(typeof u!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof u)}Object.defineProperty(D,"defaultMaxListeners",{enumerable:!0,get:function(){return qt},set:function(u){if(typeof u!="number"||u<0||Gt(u))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+u+".");qt=u}});D.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};D.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Gt(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Jt(u){return u._maxListeners===void 0?D.defaultMaxListeners:u._maxListeners}D.prototype.getMaxListeners=function(){return Jt(this)};D.prototype.emit=function(t){for(var e=[],c=1;c<arguments.length;c++)e.push(arguments[c]);var p=t==="error",T=this._events;if(T!==void 0)p=p&&T.error===void 0;else if(!p)return!1;if(p){var m;if(e.length>0&&(m=e[0]),m instanceof Error)throw m;var l=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw l.context=m,l}var n=T[t];if(n===void 0)return!1;if(typeof n=="function")Kt(n,this,e);else for(var s=n.length,f=jt(n,s),c=0;c<s;++c)Kt(f[c],this,e);return!0};function $t(u,t,e,c){var p,T,m;if(vt(e),T=u._events,T===void 0?(T=u._events=Object.create(null),u._eventsCount=0):(T.newListener!==void 0&&(u.emit("newListener",t,e.listener?e.listener:e),T=u._events),m=T[t]),m===void 0)m=T[t]=e,++u._eventsCount;else if(typeof m=="function"?m=T[t]=c?[e,m]:[m,e]:c?m.unshift(e):m.push(e),p=Jt(u),p>0&&m.length>p&&!m.warned){m.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=u,l.type=t,l.count=m.length,Ie(l)}return u}D.prototype.addListener=function(t,e){return $t(this,t,e,!1)};D.prototype.on=D.prototype.addListener;D.prototype.prependListener=function(t,e){return $t(this,t,e,!0)};function be(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zt(u,t,e){var c={fired:!1,wrapFn:void 0,target:u,type:t,listener:e},p=be.bind(c);return p.listener=e,c.wrapFn=p,p}D.prototype.once=function(t,e){return vt(e),this.on(t,zt(this,t,e)),this};D.prototype.prependOnceListener=function(t,e){return vt(e),this.prependListener(t,zt(this,t,e)),this};D.prototype.removeListener=function(t,e){var c,p,T,m,l;if(vt(e),p=this._events,p===void 0)return this;if(c=p[t],c===void 0)return this;if(c===e||c.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete p[t],p.removeListener&&this.emit("removeListener",t,c.listener||e));else if(typeof c!="function"){for(T=-1,m=c.length-1;m>=0;m--)if(c[m]===e||c[m].listener===e){l=c[m].listener,T=m;break}if(T<0)return this;T===0?c.shift():Ce(c,T),c.length===1&&(p[t]=c[0]),p.removeListener!==void 0&&this.emit("removeListener",t,l||e)}return this};D.prototype.off=D.prototype.removeListener;D.prototype.removeAllListeners=function(t){var e,c,p;if(c=this._events,c===void 0)return this;if(c.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):c[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete c[t]),this;if(arguments.length===0){var T=Object.keys(c),m;for(p=0;p<T.length;++p)m=T[p],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=c[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(p=e.length-1;p>=0;p--)this.removeListener(t,e[p]);return this};function Zt(u,t,e){var c=u._events;if(c===void 0)return[];var p=c[t];return p===void 0?[]:typeof p=="function"?e?[p.listener||p]:[p]:e?Le(p):jt(p,p.length)}D.prototype.listeners=function(t){return Zt(this,t,!0)};D.prototype.rawListeners=function(t){return Zt(this,t,!1)};D.listenerCount=function(u,t){return typeof u.listenerCount=="function"?u.listenerCount(t):Qt.call(u,t)};D.prototype.listenerCount=Qt;function Qt(u){var t=this._events;if(t!==void 0){var e=t[u];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}D.prototype.eventNames=function(){return this._eventsCount>0?gt(this._events):[]};function jt(u,t){for(var e=new Array(t),c=0;c<t;++c)e[c]=u[c];return e}function Ce(u,t){for(;t+1<u.length;t++)u[t]=u[t+1];u.pop()}function Le(u){for(var t=new Array(u.length),e=0;e<t.length;++e)t[e]=u[e].listener||u[e];return t}function Be(u,t){return new Promise(function(e,c){function p(m){u.removeListener(t,T),c(m)}function T(){typeof u.removeListener=="function"&&u.removeListener("error",p),e([].slice.call(arguments))}te(u,t,T,{once:!0}),t!=="error"&&Ae(u,p,{once:!0})})}function Ae(u,t,e){typeof u.on=="function"&&te(u,"error",t,e)}function te(u,t,e,c){if(typeof u.on=="function")c.once?u.once(t,e):u.on(t,e);else if(typeof u.addEventListener=="function")u.addEventListener(t,function p(T){c.once&&u.removeEventListener(t,p),e(T)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof u)}});var ie=rt((at,mt)=>{(function(){var u=this,t=u._,e={},c=Array.prototype,p=Object.prototype,T=Function.prototype,m=c.push,l=c.slice,n=c.concat,s=p.toString,f=p.hasOwnProperty,v=c.forEach,O=c.map,A=c.reduce,C=c.reduceRight,L=c.filter,N=c.every,$=c.some,q=c.indexOf,lt=c.lastIndexOf,tt=Array.isArray,z=Object.keys,et=T.bind,a=function(i){if(i instanceof a)return i;if(!(this instanceof a))return new a(i);this._wrapped=i};typeof at<"u"?(typeof mt<"u"&&mt.exports&&(at=mt.exports=a),at._=a):u._=a,a.VERSION="1.6.0";var x=a.each=a.forEach=function(i,r,o){if(i==null)return i;if(v&&i.forEach===v)i.forEach(r,o);else if(i.length===+i.length){for(var h=0,d=i.length;h<d;h++)if(r.call(o,i[h],h,i)===e)return}else for(var _=a.keys(i),h=0,d=_.length;h<d;h++)if(r.call(o,i[_[h]],_[h],i)===e)return;return i};a.map=a.collect=function(i,r,o){var h=[];return i==null?h:O&&i.map===O?i.map(r,o):(x(i,function(d,_,y){h.push(r.call(o,d,_,y))}),h)};var ft="Reduce of empty array with no initial value";a.reduce=a.foldl=a.inject=function(i,r,o,h){var d=arguments.length>2;if(i==null&&(i=[]),A&&i.reduce===A)return h&&(r=a.bind(r,h)),d?i.reduce(r,o):i.reduce(r);if(x(i,function(_,y,M){d?o=r.call(h,o,_,y,M):(o=_,d=!0)}),!d)throw new TypeError(ft);return o},a.reduceRight=a.foldr=function(i,r,o,h){var d=arguments.length>2;if(i==null&&(i=[]),C&&i.reduceRight===C)return h&&(r=a.bind(r,h)),d?i.reduceRight(r,o):i.reduceRight(r);var _=i.length;if(_!==+_){var y=a.keys(i);_=y.length}if(x(i,function(M,w,b){w=y?y[--_]:--_,d?o=r.call(h,o,i[w],w,b):(o=i[w],d=!0)}),!d)throw new TypeError(ft);return o},a.find=a.detect=function(i,r,o){var h;return it(i,function(d,_,y){if(r.call(o,d,_,y))return h=d,!0}),h},a.filter=a.select=function(i,r,o){var h=[];return i==null?h:L&&i.filter===L?i.filter(r,o):(x(i,function(d,_,y){r.call(o,d,_,y)&&h.push(d)}),h)},a.reject=function(i,r,o){return a.filter(i,function(h,d,_){return!r.call(o,h,d,_)},o)},a.every=a.all=function(i,r,o){r||(r=a.identity);var h=!0;return i==null?h:N&&i.every===N?i.every(r,o):(x(i,function(d,_,y){if(!(h=h&&r.call(o,d,_,y)))return e}),!!h)};var it=a.some=a.any=function(i,r,o){r||(r=a.identity);var h=!1;return i==null?h:$&&i.some===$?i.some(r,o):(x(i,function(d,_,y){if(h||(h=r.call(o,d,_,y)))return e}),!!h)};a.contains=a.include=function(i,r){return i==null?!1:q&&i.indexOf===q?i.indexOf(r)!=-1:it(i,function(o){return o===r})},a.invoke=function(i,r){var o=l.call(arguments,2),h=a.isFunction(r);return a.map(i,function(d){return(h?r:d[r]).apply(d,o)})},a.pluck=function(i,r){return a.map(i,a.property(r))},a.where=function(i,r){return a.filter(i,a.matches(r))},a.findWhere=function(i,r){return a.find(i,a.matches(r))},a.max=function(i,r,o){if(!r&&a.isArray(i)&&i[0]===+i[0]&&i.length<65535)return Math.max.apply(Math,i);var h=-1/0,d=-1/0;return x(i,function(_,y,M){var w=r?r.call(o,_,y,M):_;w>d&&(h=_,d=w)}),h},a.min=function(i,r,o){if(!r&&a.isArray(i)&&i[0]===+i[0]&&i.length<65535)return Math.min.apply(Math,i);var h=1/0,d=1/0;return x(i,function(_,y,M){var w=r?r.call(o,_,y,M):_;w<d&&(h=_,d=w)}),h},a.shuffle=function(i){var r,o=0,h=[];return x(i,function(d){r=a.random(o++),h[o-1]=h[r],h[r]=d}),h},a.sample=function(i,r,o){return r==null||o?(i.length!==+i.length&&(i=a.values(i)),i[a.random(i.length-1)]):a.shuffle(i).slice(0,Math.max(0,r))};var nt=function(i){return i==null?a.identity:a.isFunction(i)?i:a.property(i)};a.sortBy=function(i,r,o){return r=nt(r),a.pluck(a.map(i,function(h,d,_){return{value:h,index:d,criteria:r.call(o,h,d,_)}}).sort(function(h,d){var _=h.criteria,y=d.criteria;if(_!==y){if(_>y||_===void 0)return 1;if(_<y||y===void 0)return-1}return h.index-d.index}),"value")};var G=function(i){return function(r,o,h){var d={};return o=nt(o),x(r,function(_,y){var M=o.call(h,_,y,r);i(d,M,_)}),d}};a.groupBy=G(function(i,r,o){a.has(i,r)?i[r].push(o):i[r]=[o]}),a.indexBy=G(function(i,r,o){i[r]=o}),a.countBy=G(function(i,r){a.has(i,r)?i[r]++:i[r]=1}),a.sortedIndex=function(i,r,o,h){o=nt(o);for(var d=o.call(h,r),_=0,y=i.length;_<y;){var M=_+y>>>1;o.call(h,i[M])<d?_=M+1:y=M}return _},a.toArray=function(i){return i?a.isArray(i)?l.call(i):i.length===+i.length?a.map(i,a.identity):a.values(i):[]},a.size=function(i){return i==null?0:i.length===+i.length?i.length:a.keys(i).length},a.first=a.head=a.take=function(i,r,o){if(i!=null)return r==null||o?i[0]:r<0?[]:l.call(i,0,r)},a.initial=function(i,r,o){return l.call(i,0,i.length-(r==null||o?1:r))},a.last=function(i,r,o){if(i!=null)return r==null||o?i[i.length-1]:l.call(i,Math.max(i.length-r,0))},a.rest=a.tail=a.drop=function(i,r,o){return l.call(i,r==null||o?1:r)},a.compact=function(i){return a.filter(i,a.identity)};var g=function(i,r,o){return r&&a.every(i,a.isArray)?n.apply(o,i):(x(i,function(h){a.isArray(h)||a.isArguments(h)?r?m.apply(o,h):g(h,r,o):o.push(h)}),o)};a.flatten=function(i,r){return g(i,r,[])},a.without=function(i){return a.difference(i,l.call(arguments,1))},a.partition=function(i,r){var o=[],h=[];return x(i,function(d){(r(d)?o:h).push(d)}),[o,h]},a.uniq=a.unique=function(i,r,o,h){a.isFunction(r)&&(h=o,o=r,r=!1);var d=o?a.map(i,o,h):i,_=[],y=[];return x(d,function(M,w){(r?!w||y[y.length-1]!==M:!a.contains(y,M))&&(y.push(M),_.push(i[w]))}),_},a.union=function(){return a.uniq(a.flatten(arguments,!0))},a.intersection=function(i){var r=l.call(arguments,1);return a.filter(a.uniq(i),function(o){return a.every(r,function(h){return a.contains(h,o)})})},a.difference=function(i){var r=n.apply(c,l.call(arguments,1));return a.filter(i,function(o){return!a.contains(r,o)})},a.zip=function(){for(var i=a.max(a.pluck(arguments,"length").concat(0)),r=new Array(i),o=0;o<i;o++)r[o]=a.pluck(arguments,""+o);return r},a.object=function(i,r){if(i==null)return{};for(var o={},h=0,d=i.length;h<d;h++)r?o[i[h]]=r[h]:o[i[h][0]]=i[h][1];return o},a.indexOf=function(i,r,o){if(i==null)return-1;var h=0,d=i.length;if(o)if(typeof o=="number")h=o<0?Math.max(0,d+o):o;else return h=a.sortedIndex(i,r),i[h]===r?h:-1;if(q&&i.indexOf===q)return i.indexOf(r,o);for(;h<d;h++)if(i[h]===r)return h;return-1},a.lastIndexOf=function(i,r,o){if(i==null)return-1;var h=o!=null;if(lt&&i.lastIndexOf===lt)return h?i.lastIndexOf(r,o):i.lastIndexOf(r);for(var d=h?o:i.length;d--;)if(i[d]===r)return d;return-1},a.range=function(i,r,o){arguments.length<=1&&(r=i||0,i=0),o=arguments[2]||1;for(var h=Math.max(Math.ceil((r-i)/o),0),d=0,_=new Array(h);d<h;)_[d++]=i,i+=o;return _};var E=function(){};a.bind=function(i,r){var o,h;if(et&&i.bind===et)return et.apply(i,l.call(arguments,1));if(!a.isFunction(i))throw new TypeError;return o=l.call(arguments,2),h=function(){if(!(this instanceof h))return i.apply(r,o.concat(l.call(arguments)));E.prototype=i.prototype;var d=new E;E.prototype=null;var _=i.apply(d,o.concat(l.call(arguments)));return Object(_)===_?_:d}},a.partial=function(i){var r=l.call(arguments,1);return function(){for(var o=0,h=r.slice(),d=0,_=h.length;d<_;d++)h[d]===a&&(h[d]=arguments[o++]);for(;o<arguments.length;)h.push(arguments[o++]);return i.apply(this,h)}},a.bindAll=function(i){var r=l.call(arguments,1);if(r.length===0)throw new Error("bindAll must be passed function names");return x(r,function(o){i[o]=a.bind(i[o],i)}),i},a.memoize=function(i,r){var o={};return r||(r=a.identity),function(){var h=r.apply(this,arguments);return a.has(o,h)?o[h]:o[h]=i.apply(this,arguments)}},a.delay=function(i,r){var o=l.call(arguments,2);return setTimeout(function(){return i.apply(null,o)},r)},a.defer=function(i){return a.delay.apply(a,[i,1].concat(l.call(arguments,1)))},a.throttle=function(i,r,o){var h,d,_,y=null,M=0;o||(o={});var w=function(){M=o.leading===!1?0:a.now(),y=null,_=i.apply(h,d),h=d=null};return function(){var b=a.now();!M&&o.leading===!1&&(M=b);var k=r-(b-M);return h=this,d=arguments,k<=0?(clearTimeout(y),y=null,M=b,_=i.apply(h,d),h=d=null):!y&&o.trailing!==!1&&(y=setTimeout(w,k)),_}},a.debounce=function(i,r,o){var h,d,_,y,M,w=function(){var b=a.now()-y;b<r?h=setTimeout(w,r-b):(h=null,o||(M=i.apply(_,d),_=d=null))};return function(){_=this,d=arguments,y=a.now();var b=o&&!h;return h||(h=setTimeout(w,r)),b&&(M=i.apply(_,d),_=d=null),M}},a.once=function(i){var r=!1,o;return function(){return r||(r=!0,o=i.apply(this,arguments),i=null),o}},a.wrap=function(i,r){return a.partial(r,i)},a.compose=function(){var i=arguments;return function(){for(var r=arguments,o=i.length-1;o>=0;o--)r=[i[o].apply(this,r)];return r[0]}},a.after=function(i,r){return function(){if(--i<1)return r.apply(this,arguments)}},a.keys=function(i){if(!a.isObject(i))return[];if(z)return z(i);var r=[];for(var o in i)a.has(i,o)&&r.push(o);return r},a.values=function(i){for(var r=a.keys(i),o=r.length,h=new Array(o),d=0;d<o;d++)h[d]=i[r[d]];return h},a.pairs=function(i){for(var r=a.keys(i),o=r.length,h=new Array(o),d=0;d<o;d++)h[d]=[r[d],i[r[d]]];return h},a.invert=function(i){for(var r={},o=a.keys(i),h=0,d=o.length;h<d;h++)r[i[o[h]]]=o[h];return r},a.functions=a.methods=function(i){var r=[];for(var o in i)a.isFunction(i[o])&&r.push(o);return r.sort()},a.extend=function(i){return x(l.call(arguments,1),function(r){if(r)for(var o in r)i[o]=r[o]}),i},a.pick=function(i){var r={},o=n.apply(c,l.call(arguments,1));return x(o,function(h){h in i&&(r[h]=i[h])}),r},a.omit=function(i){var r={},o=n.apply(c,l.call(arguments,1));for(var h in i)a.contains(o,h)||(r[h]=i[h]);return r},a.defaults=function(i){return x(l.call(arguments,1),function(r){if(r)for(var o in r)i[o]===void 0&&(i[o]=r[o])}),i},a.clone=function(i){return a.isObject(i)?a.isArray(i)?i.slice():a.extend({},i):i},a.tap=function(i,r){return r(i),i};var S=function(i,r,o,h){if(i===r)return i!==0||1/i==1/r;if(i==null||r==null)return i===r;i instanceof a&&(i=i._wrapped),r instanceof a&&(r=r._wrapped);var d=s.call(i);if(d!=s.call(r))return!1;switch(d){case"[object String]":return i==String(r);case"[object Number]":return i!=+i?r!=+r:i==0?1/i==1/r:i==+r;case"[object Date]":case"[object Boolean]":return+i==+r;case"[object RegExp]":return i.source==r.source&&i.global==r.global&&i.multiline==r.multiline&&i.ignoreCase==r.ignoreCase}if(typeof i!="object"||typeof r!="object")return!1;for(var _=o.length;_--;)if(o[_]==i)return h[_]==r;var y=i.constructor,M=r.constructor;if(y!==M&&!(a.isFunction(y)&&y instanceof y&&a.isFunction(M)&&M instanceof M)&&"constructor"in i&&"constructor"in r)return!1;o.push(i),h.push(r);var w=0,b=!0;if(d=="[object Array]"){if(w=i.length,b=w==r.length,b)for(;w--&&(b=S(i[w],r[w],o,h)););}else{for(var k in i)if(a.has(i,k)&&(w++,!(b=a.has(r,k)&&S(i[k],r[k],o,h))))break;if(b){for(k in r)if(a.has(r,k)&&!w--)break;b=!w}}return o.pop(),h.pop(),b};a.isEqual=function(i,r){return S(i,r,[],[])},a.isEmpty=function(i){if(i==null)return!0;if(a.isArray(i)||a.isString(i))return i.length===0;for(var r in i)if(a.has(i,r))return!1;return!0},a.isElement=function(i){return!!(i&&i.nodeType===1)},a.isArray=tt||function(i){return s.call(i)=="[object Array]"},a.isObject=function(i){return i===Object(i)},x(["Arguments","Function","String","Number","Date","RegExp"],function(i){a["is"+i]=function(r){return s.call(r)=="[object "+i+"]"}}),a.isArguments(arguments)||(a.isArguments=function(i){return!!(i&&a.has(i,"callee"))}),typeof/./!="function"&&(a.isFunction=function(i){return typeof i=="function"}),a.isFinite=function(i){return isFinite(i)&&!isNaN(parseFloat(i))},a.isNaN=function(i){return a.isNumber(i)&&i!=+i},a.isBoolean=function(i){return i===!0||i===!1||s.call(i)=="[object Boolean]"},a.isNull=function(i){return i===null},a.isUndefined=function(i){return i===void 0},a.has=function(i,r){return f.call(i,r)},a.noConflict=function(){return u._=t,this},a.identity=function(i){return i},a.constant=function(i){return function(){return i}},a.property=function(i){return function(r){return r[i]}},a.matches=function(i){return function(r){if(r===i)return!0;for(var o in i)if(i[o]!==r[o])return!1;return!0}},a.times=function(i,r,o){for(var h=Array(Math.max(0,i)),d=0;d<i;d++)h[d]=r.call(o,d);return h},a.random=function(i,r){return r==null&&(r=i,i=0),i+Math.floor(Math.random()*(r-i+1))},a.now=Date.now||function(){return new Date().getTime()};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};P.unescape=a.invert(P.escape);var V={escape:new RegExp("["+a.keys(P.escape).join("")+"]","g"),unescape:new RegExp("("+a.keys(P.unescape).join("|")+")","g")};a.each(["escape","unescape"],function(i){a[i]=function(r){return r==null?"":(""+r).replace(V[i],function(o){return P[i][o]})}}),a.result=function(i,r){if(i!=null){var o=i[r];return a.isFunction(o)?o.call(i):o}},a.mixin=function(i){x(a.functions(i),function(r){var o=a[r]=i[r];a.prototype[r]=function(){var h=[this._wrapped];return m.apply(h,arguments),F.call(this,o.apply(a,h))}})};var B=0;a.uniqueId=function(i){var r=++B+"";return i?i+r:r},a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var R=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},X=/\\|'|\r|\n|\t|\u2028|\u2029/g;a.template=function(i,r,o){var h;o=a.defaults({},o,a.templateSettings);var d=new RegExp([(o.escape||R).source,(o.interpolate||R).source,(o.evaluate||R).source].join("|")+"|$","g"),_=0,y="__p+='";i.replace(d,function(w,b,k,Nt,It){return y+=i.slice(_,It).replace(X,function(he){return"\\"+I[he]}),b&&(y+=`'+
((__t=(`+b+`))==null?'':_.escape(__t))+
'`),k&&(y+=`'+
((__t=(`+k+`))==null?'':__t)+
'`),Nt&&(y+=`';
`+Nt+`
__p+='`),_=It+w.length,w}),y+=`';
`,o.variable||(y=`with(obj||{}){
`+y+`}
`),y=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+y+`return __p;
`;try{h=new Function(o.variable||"obj","_",y)}catch(w){throw w.source=y,w}if(r)return h(r,a);var M=function(w){return h.call(this,w,a)};return M.source="function("+(o.variable||"obj")+`){
`+y+"}",M},a.chain=function(i){return a(i).chain()};var F=function(i){return this._chain?a(i).chain():i};a.mixin(a),x(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var r=c[i];a.prototype[i]=function(){var o=this._wrapped;return r.apply(o,arguments),(i=="shift"||i=="splice")&&o.length===0&&delete o[0],F.call(this,o)}}),x(["concat","join","slice"],function(i){var r=c[i];a.prototype[i]=function(){return F.call(this,r.apply(this._wrapped,arguments))}}),a.extend(a.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return a})}).call(at)});var ne=rt((ot,_t)=>{(function(){var c=this,u=ee().EventEmitter,t=ie(),e=/([0-9\.]+)(ms|s|m|h)?/,c=globalThis||window;typeof Function.prototype.inherits>"u"&&(Function.prototype.inherits=function(l){this.prototype=Object.create(l.prototype)}),typeof Array.prototype.removeOne>"u"&&(Array.prototype.removeOne=function(){for(var l,n=arguments,s=n.length,f;s&&this.length;)for(l=n[--s];(f=this.indexOf(l))!==-1;)return this.splice(f,1)});function p(l){for(var n=1,s=t.min(l);n!==0;)n=t.reduce(l,function(f,v){return f+v%s},0),n!==0&&(s-=10);return s}function T(l){var n=e.exec(l);if(!n)throw new Error("I don't understand that particular interval");var s=+n[1],f=n[2]||"ms";if(f==="s")s=s*1e3;else if(f==="m")s=s*1e3*60;else if(f==="h")s=s*1e3*60*60;else if(f&&f!=="ms")throw new Error("You can only specify intervals of ms, s, m, or h");if(s<10||s%10!==0)throw new Error("You can only specify 10s of milliseconds, trust me on this one");return{amount:s,type:f}}function m(){this.intervalId=void 0,this.intervalLength=void 0,this.intervalsToEmit={},this.currentTick=1,this.maxTicks=0,this.listeningForFocus=!1;var l=function(){var n=p(t.keys(this.intervalsToEmit)),s=!1;return this.intervalLength?n!==this.intervalLength&&(this.intervalLength=n,s=!0):this.intervalLength=n,this.maxTicks=t.max(t.map(t.keys(this.intervalsToEmit),function(f){return+f}))/this.intervalLength,s}.bind(this);this.on("newListener",function(n){if(!(n==="removeListener"||n==="newListener")){var s=T(n),f=s.amount;this.intervalsToEmit[+f]=t.union(this.intervalsToEmit[+f]||[],[n]),l()&&this.isStarted()&&this.stop().start()}}),this.on("removeListener",function(n){if(!(u.listenerCount(this,n)>0)){var s=T(n),f=s.amount,v=this.intervalsToEmit[+f].removeOne(n);this.intervalsToEmit[+f].length===0&&delete this.intervalsToEmit[+f],console.log("Determining interval length after removal of",v),l(),l()&&this.isStarted()&&this.stop().start()}})}m.inherits(u),m.prototype.tick=function(){var l=this.currentTick*this.intervalLength;return t.each(this.intervalsToEmit,function(n,s){l%s===0&&t.each(n,function(f){this.emit(f,f,s)}.bind(this))}.bind(this)),this.currentTick+=1,this.currentTick>this.maxTicks&&(this.currentTick=1),this},m.prototype.start=function(){if(!this.intervalLength)throw new Error("You haven't specified any interval callbacks. Use EventedLoop.on('500ms', function () { ... }) to do so, and then you can start");return this.intervalId?console.log("No need to start the loop again, it's already started."):(this.intervalId=setInterval(this.tick.bind(this),this.intervalLength),c&&!this.listeningForFocus&&c.addEventListener&&(c.addEventListener("focus",function(){this.start()}.bind(this)),c.addEventListener("blur",function(){this.stop()}.bind(this)),this.listeningForFocus=!0),this)},m.prototype.stop=function(){return clearInterval(this.intervalId),this.intervalId=void 0,this},m.prototype.isStarted=function(){return!!this.intervalId},m.prototype.every=m.prototype.on,typeof ot<"u"&&(typeof _t<"u"&&_t.exports&&(ot=_t.exports=m),ot.EventedLoop=m),typeof window<"u"&&(window.EventedLoop=m)}).call(ot)});var ue=Et(Ct(),1),Y=Et(Lt(),1);function me(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}var Bt=me;var Tt=class u{constructor(t){this._ctx=t,this._images={},this._centralSprite=null}storeLoadedImage(t,e){this._images[t]=e}getLoadedImage(t){return this._images[t]}followSprite(t){this._centralSprite=t}getCentralPosition(){return{map:this._centralSprite.mapPosition,canvas:[Math.round(this._ctx.canvas.width*.5),Math.round(this._ctx.canvas.height*.5),0]}}mapPositionToCanvasPosition(t){var e=this.getCentralPosition(),c=e.map[0]-t[0],p=e.map[1]-t[1];return[e.canvas[0]-c,e.canvas[1]-p]}canvasPositionToMapPosition(t){var e=this.getCentralPosition(),c=e.canvas[0]-t[0],p=e.canvas[1]-t[1];return[e.map[0]-c,e.map[1]-p]}getCentreOfViewport(){return Math.floor(this._ctx.canvas.width/2)}getMiddleOfViewport(){return Math.floor(this._ctx.canvas.height/2)}getBelowViewport(){return Math.floor(this._ctx.canvas.height)}getMapBelowViewport(){var t=this.getBelowViewport();return this.canvasPositionToMapPosition([0,t])[1]}getAboveViewport(){return 0-Math.floor(this._ctx.canvas.height/4)}getTopOfViewport(){return this.canvasPositionToMapPosition([0,0])[1]}getRandomlyInTheCentreOfCanvas(t){var e=0,c=this._ctx.canvas.width;return t&&(e-=t,c+=t),Math.floor(Math.random()*(c-e+1))+e}getRandomlyInTheCentreOfMap(t){var e=this.getRandomlyInTheCentreOfCanvas(t);return this.canvasPositionToMapPosition([e,0])[0]}getRandomMapPositionBelowViewport(){var t=this.getRandomlyInTheCentreOfCanvas(),e=this.getBelowViewport();return this.canvasPositionToMapPosition([t,e])}getRandomMapPositionAboveViewport(){var t=this.getRandomlyInTheCentreOfCanvas(),e=this.getAboveViewport();return this.canvasPositionToMapPosition([t,e])}static create(t){let e=new u(t);return new Proxy(e,{get(c,p){if(p in c){let m=c[p];return typeof m=="function"?m.bind(c):m}let T=t[p];return typeof T=="function"?T.bind(t):T},set(c,p,T){return p in c?c[p]=T:t[p]=T,!0}})}},At=Tt;function _e(){var u=function(){return Math.floor(Math.random()*65536).toString(16)};return u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u()}var kt=_e;var yt=class u{constructor(t){this._hittableObjects={},this._zIndexesOccupied=[0],this._trackedSpriteToMoveToward=void 0,this.direction=void 0,this.mapPosition=[0,0,0],this.id=kt(),this.canvasX=0,this.canvasY=0,this.canvasZ=0,this.height=0,this.speed=0,this.data=t||{parts:{}},this.movingToward=[0,0],this.metresDownTheMountain=0,this.movingWithConviction=!1,this.deleted=!1,this.data.parts||(this.data.parts={});let e=Object.values(this.data.parts).map(c=>c[3]);this.maxHeight=e.length?Math.max(...e):void 0,this.isMoving=!0,t&&t.id&&(this.id=t.id),t&&t.zIndexesOccupied&&(this._zIndexesOccupied=t.zIndexesOccupied)}_incrementX(t){this.canvasX+=parseFloat(t)}_incrementY(t){this.canvasY+=parseFloat(t)}_getHitBox(t){if(this.data.hitBoxes&&this.data.hitBoxes[t])return this.data.hitBoxes[t]}_roundHalf(t){return Math.round(t*2)/2}_move(){if(this.isMoving){var t=this.mapPosition[0],e=this.mapPosition[1];if(typeof this.direction<"u"){var c=this.direction-90;c<0&&(c=360+c),t+=this._roundHalf(this.speed*Math.cos(c*(Math.PI/180))),e+=this._roundHalf(this.speed*Math.sin(c*(Math.PI/180)))}else typeof this.movingToward[0]<"u"&&(t>this.movingToward[0]?t-=Math.min(this.getSpeedX(),Math.abs(t-this.movingToward[0])):t<this.movingToward[0]&&(t+=Math.min(this.getSpeedX(),Math.abs(t-this.movingToward[0])))),typeof this.movingToward[1]<"u"&&(e>this.movingToward[1]?e-=Math.min(this.getSpeedY(),Math.abs(e-this.movingToward[1])):e<this.movingToward[1]&&(e+=Math.min(this.getSpeedY(),Math.abs(e-this.movingToward[1]))));this.setMapPosition(t,e)}}draw(t,e){var c=this.data.parts[e];this.height=c[3],this.width=c[2];var p=t.mapPositionToCanvasPosition(this.mapPosition);this.setCanvasPosition(p[0],p[1]),t.drawImage(t.getLoadedImage(this.data.$imageFile),c[0],c[1],c[2],c[3],this.canvasX,this.canvasY,c[2],c[3])}setMapPosition(t,e,c){typeof t>"u"&&(t=this.mapPosition[0]),typeof e>"u"&&(e=this.mapPosition[1]),typeof c>"u"?c=this.mapPosition[2]:this._zIndexesOccupied=[c],this.mapPosition=[t,e,c]}setCanvasPosition(t,e){t&&(typeof t=="string"&&(t[0]==="+"||t[0]==="-")?this._incrementX(t):this.canvasX=t),e&&(typeof e=="string"&&(e[0]==="+"||e[0]==="-")?this._incrementY(e):this.canvasY=e)}getCanvasPositionX(){return this.canvasX}getCanvasPositionY(){return this.canvasY}getLeftHitBoxEdge(t){t=t||0;var e=this.getCanvasPositionX();return this._getHitBox(t)&&(e+=this._getHitBox(t)[0]),e}getTopHitBoxEdge(t){t=t||0;var e=this.getCanvasPositionY();return this._getHitBox(t)&&(e+=this._getHitBox(t)[1]),e}getRightHitBoxEdge(t){return t=t||0,this._getHitBox(t)?this.canvasX+this._getHitBox(t)[2]:this.canvasX+this.width}getBottomHitBoxEdge(t){return t=t||0,this._getHitBox(t)?this.canvasY+this._getHitBox(t)[3]:this.canvasY+this.height}getPositionInFrontOf(){return[this.canvasX,this.canvasY+this.height]}setSpeed(t){this.speed=t,this.speedX=t,this.speedY=t}incrementSpeedBy(t){this.speed+=t}getSpeed(){return this.speed}getSpeedX(){return this.speed}getSpeedY(){return this.speed}setHeight(t){this.height=t}setWidth(t){this.width=t}getMaxHeight(){return this.maxHeight}getMovingTowardOpposite(){if(!this.isMoving)return[0,0];var t=this.movingToward[0]-this.mapPosition[0],e=this.movingToward[1]-this.mapPosition[1],c=Math.abs(t)>75?0-t:0;return[c,-e]}checkHittableObjects(){Object.keys(this._hittableObjects).forEach(t=>{var e=this._hittableObjects[t];e.object.deleted?delete this._hittableObjects[t]:e.object.hits(this)&&e.callbacks.forEach(c=>c(this,e.object))})}cycle(){this.checkHittableObjects(),this._trackedSpriteToMoveToward&&this.setMapPositionTarget(this._trackedSpriteToMoveToward.mapPosition[0],this._trackedSpriteToMoveToward.mapPosition[1],!0),this._move()}setMapPositionTarget(t,e,c){c&&(this.movingWithConviction=!1),this.movingWithConviction||(typeof t>"u"&&(t=this.movingToward[0]),typeof e>"u"&&(e=this.movingToward[1]),this.movingToward=[t,e],this.movingWithConviction=!1)}setDirection(t){t>=360&&(t=360-t),this.direction=t,this.movingToward=void 0}resetDirection(){this.direction=void 0}setMapPositionTargetWithConviction(t,e){this.setMapPositionTarget(t,e),this.movingWithConviction=!0}follow(t){this._trackedSpriteToMoveToward=t}stopFollowing(){this._trackedSpriteToMoveToward=!1}onHitting(t,e){if(this._hittableObjects[t.id])return this._hittableObjects[t.id].callbacks.push(e);this._hittableObjects[t.id]={object:t,callbacks:[e]}}deleteOnNextCycle(){this.deleted=!0}occupiesZIndex(t){return this._zIndexesOccupied.indexOf(t)>=0}hits(t){var e=!1,c=!1,p=this.mapPosition[2];return t.getTopHitBoxEdge(p)<=this.getBottomHitBoxEdge(p)&&t.getBottomHitBoxEdge(p)>=this.getBottomHitBoxEdge(p)&&(e=!0),t.getTopHitBoxEdge(p)<=this.getTopHitBoxEdge(p)&&t.getBottomHitBoxEdge(p)>=this.getTopHitBoxEdge(p)&&(e=!0),t.getLeftHitBoxEdge(p)<=this.getRightHitBoxEdge(p)&&t.getRightHitBoxEdge(p)>=this.getRightHitBoxEdge(p)&&(c=!0),t.getLeftHitBoxEdge(p)<=this.getLeftHitBoxEdge(p)&&t.getRightHitBoxEdge(p)>=this.getLeftHitBoxEdge(p)&&(c=!0),e&&c}isAboveOnCanvas(t){return this.canvasY+this.height<t}isBelowOnCanvas(t){return this.canvasY>t}static createObjects(t,e){Array.isArray(t)||(t=[t]),e=Object.assign({rateModifier:0,dropRate:1,position:[0,0]},e);function c(p){var T=e.position;if(Math.floor(Math.random()*(101+e.rateModifier))<=p.dropRate){var m=new u(p.sprite);return m.setSpeed(0),typeof T=="function"&&(T=T()),m.setMapPosition(T[0],T[1]),p.sprite.hitBehaviour&&p.sprite.hitBehaviour.skier&&e.player&&m.onHitting(e.player,p.sprite.hitBehaviour.skier),m}}return t.map(c).filter(p=>p!==void 0)}},U=yt;var St=class extends U{constructor(t){super(t),this._spriteVersion=1,this._eatingStage=0,this.isEating=!1,this.isFull=!1,this.setSpeed(6)}draw(t){let e=()=>{var c=this.movingToward[0]-this.canvasX;return this.isEating?"eating"+this._eatingStage:(this._spriteVersion+.1>2?this._spriteVersion=.1:this._spriteVersion+=.1,c>=0?"sEast"+Math.ceil(this._spriteVersion):"sWest"+Math.ceil(this._spriteVersion))};return super.draw(t,e())}startEating(t){this._eatingStage+=1,this.isEating=!0,this.isMoving=!1,this._eatingStage<6?setTimeout(()=>this.startEating(t),300):(this._eatingStage=0,this.isEating=!1,this.isMoving=!0,t())}},Ht=St;var wt=class extends U{constructor(t){super(t),this._standardSpeed=3,this.setSpeed(this._standardSpeed)}_getDirection(){var t=this.movingToward[0]-this.mapPosition[0];return t>0?"sEast":"sWest"}cycle(t){Math.floor(Math.random()*11)===1&&(this.setMapPositionTarget(t.getRandomlyInTheCentreOfMap()),this.setSpeed(this._standardSpeed+Math.floor(Math.random()*3)-1)),this.setMapPositionTarget(void 0,t.getMapBelowViewport()+600),super.cycle()}draw(t){return super.draw(t,this._getDirection())}},Vt=wt;typeof navigator<"u"?navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate:globalThis.navigator={vibrate:!1};var Ft={west:270,wsWest:240,sWest:195,south:180,sEast:165,esEast:120,east:90},Mt=class extends U{constructor(t){super(t),this._cancelableStateTimeout=null,this._cancelableStateInterval=null,this._canSpeedBoost=!0,this._obstaclesHit=[],this._pixelsTravelled=0,this._standardSpeed=5,this._turnEaseCycles=70,this._speedX=0,this._speedXFactor=0,this._speedY=0,this._speedYFactor=1,this._trickStep=0,this.isMoving=!0,this.hasBeenHit=!1,this.isJumping=!1,this.isPerformingTrick=!1,this.onHitObstacleCb=function(){},this.setSpeed(this._standardSpeed)}_setNormal(){this.setSpeed(this._standardSpeed),this.isMoving=!0,this.hasBeenHit=!1,this.isJumping=!1,this.isPerformingTrick=!1,this._cancelableStateInterval&&clearInterval(this._cancelableStateInterval),this.setMapPosition(void 0,void 0,0)}_setCrashed(){this.isMoving=!1,this.hasBeenHit=!0,this.isJumping=!1,this.isPerformingTrick=!1,this._cancelableStateInterval&&clearInterval(this._cancelableStateInterval),this.setMapPosition(void 0,void 0,0)}_setJumping(){var t=this.getSpeed();this.setSpeed(t+2),this.setSpeedY(t+2),this.isMoving=!0,this.hasBeenHit=!1,this.isJumping=!0,this.setMapPosition(void 0,void 0,1)}_getDiscreteDirection(){if(this.direction)return this.direction<=90?"east":this.direction>90&&this.direction<150?"esEast":this.direction>=150&&this.direction<180?"sEast":this.direction===180?"south":this.direction>180&&this.direction<=210?"sWest":this.direction>210&&this.direction<270?"wsWest":this.direction>=270?"west":"south";var t=this.movingToward[0]-this.mapPosition[0],e=this.movingToward[1]-this.mapPosition[1];return e<=0?t>0?"east":"west":t>300?"esEast":t>75?"sEast":t<-300?"wsWest":t<-75?"sWest":"south"}_setDiscreteDirection(t){Ft[t]&&this.setDirection(Ft[t]),this.isMoving=t!=="west"&&t!=="east"}_getBeingEatenSprite(){return"blank"}_getJumpingSprite(){return"jumping"}_getTrickSprite(){return console.log("Trick step is",this._trickStep),this._trickStep===0?"jumping":this._trickStep===1?"somersault1":"somersault2"}_easeSpeedToTargetUsingFactor(t,e,c){return c===0||c===1?e:(t<e&&(t+=this.getSpeed()*(c/this._turnEaseCycles)),t>e&&(t-=this.getSpeed()*(c/this._turnEaseCycles)),t)}stop(){this.direction>180?this._setDiscreteDirection("west"):this._setDiscreteDirection("east")}turnEast(){if(!this.hasBeenHit)switch(this._getDiscreteDirection()){case"west":this._setDiscreteDirection("wsWest");break;case"wsWest":this._setDiscreteDirection("sWest");break;case"sWest":this._setDiscreteDirection("south");break;case"south":this._setDiscreteDirection("sEast");break;case"sEast":this._setDiscreteDirection("esEast");break;case"esEast":this._setDiscreteDirection("east");break;default:this._setDiscreteDirection("south");break}}turnWest(){if(!this.hasBeenHit)switch(this._getDiscreteDirection()){case"east":this._setDiscreteDirection("esEast");break;case"esEast":this._setDiscreteDirection("sEast");break;case"sEast":this._setDiscreteDirection("south");break;case"south":this._setDiscreteDirection("sWest");break;case"sWest":this._setDiscreteDirection("wsWest");break;case"wsWest":this._setDiscreteDirection("west");break;default:this._setDiscreteDirection("south");break}}stepWest(){this.hasBeenHit||(this.mapPosition[0]-=this.speed*2)}stepEast(){this.hasBeenHit||(this.mapPosition[0]+=this.speed*2)}setMapPositionTarget(t,e){this.hasBeenHit||(Math.abs(this.mapPosition[0]-t)<=75&&(t=this.mapPosition[0]),this.movingToward=[t,e])}startMovingIfPossible(){!this.hasBeenHit&&!this.isBeingEaten&&(this.isMoving=!0)}setTurnEaseCycles(t){this._turnEaseCycles=t}getPixelsTravelledDownMountain(){return this._pixelsTravelled}getStandardSpeed(){return this._standardSpeed}resetSpeed(){this.setSpeed(this._standardSpeed)}setSpeedY(t){this._speedY=t}getSpeedX(){var t=this._getDiscreteDirection();return t==="esEast"||t==="wsWest"?(this._speedXFactor=.5,this._speedX=this._easeSpeedToTargetUsingFactor(this._speedX,this.getSpeed()*.5,.5),this._speedX):t==="sEast"||t==="sWest"?(this._speedXFactor=.33,this._speedX=this._easeSpeedToTargetUsingFactor(this._speedX,this.getSpeed()*.33,.33),this._speedX):(this._speedX=this._easeSpeedToTargetUsingFactor(this._speedX,0,this._speedXFactor),this._speedX)}getSpeedY(){var t=this._getDiscreteDirection();return this.isJumping?this._speedY:t==="esEast"||t==="wsWest"?(this._speedYFactor=.6,this._speedY=this._easeSpeedToTargetUsingFactor(this._speedY,this.getSpeed()*.6,.6),this._speedY):t==="sEast"||t==="sWest"?(this._speedYFactor=.85,this._speedY=this._easeSpeedToTargetUsingFactor(this._speedY,this.getSpeed()*.85,.85),this._speedY):t==="east"||t==="west"?(this._speedYFactor=1,this._speedY=0,this._speedY):(this._speedY=this._easeSpeedToTargetUsingFactor(this._speedY,this.getSpeed(),this._speedYFactor),this._speedY)}cycle(){this.getSpeedX()<=0&&this.getSpeedY()<=0&&(this.isMoving=!1),this.isMoving&&(this._pixelsTravelled+=this.speed),this.isJumping&&this.setMapPositionTarget(void 0,this.mapPosition[1]+this.getSpeed()),super.cycle(),this.checkHittableObjects()}draw(t){let e=()=>this.isBeingEaten?this._getBeingEatenSprite():this.isJumping?this.isPerformingTrick?this._getTrickSprite():this._getJumpingSprite():this.hasBeenHit?"hit":this._getDiscreteDirection();return super.draw(t,e())}hits(t){return this._obstaclesHit.indexOf(t.id)!==-1||!t.occupiesZIndex(this.mapPosition[2])?!1:super.hits(t)}speedBoost(){var t=this.speed;this._canSpeedBoost&&(this._canSpeedBoost=!1,this.setSpeed(this.speed*2),setTimeout(()=>{this.setSpeed(t),setTimeout(()=>{this._canSpeedBoost=!0},1e4)},2e3))}attemptTrick(){this.isJumping&&(this.isPerformingTrick=!0,this._cancelableStateInterval=setInterval(()=>{this._trickStep=this._trickStep>=2?0:this._trickStep+1},300))}hasHitObstacle(t){this._setCrashed(),navigator.vibrate&&navigator.vibrate(500),this._obstaclesHit.push(t.id),this.resetSpeed(),this.onHitObstacleCb(t),this._cancelableStateTimeout&&clearTimeout(this._cancelableStateTimeout),this._cancelableStateTimeout=setTimeout(()=>this._setNormal(),1500)}hasHitJump(){this._setJumping(),this._cancelableStateTimeout&&clearTimeout(this._cancelableStateTimeout),this._cancelableStateTimeout=setTimeout(()=>this._setNormal(),1e3)}isEatenBy(t,e){this.hasHitObstacle(t),t.startEating(e),this._obstaclesHit.push(t.id),this.isMoving=!1,this.isBeingEaten=!0}reset(){this._obstaclesHit=[],this._pixelsTravelled=0,this.isMoving=!0,this.isJumping=!1,this.hasBeenHit=!1,this._canSpeedBoost=!0}setHitObstacleCb(t){this.onHitObstacleCb=t||function(){}}},Ut=Mt;var Ot=class{constructor(t){this.lines=t.initialLines,this.top=t.position.top,this.right=t.position.right,this.bottom=t.position.bottom,this.left=t.position.left,this.width=t.width,this.height=t.height}setLines(t){this.lines=t}draw(t){t.font="11px monospace";var e=0;this.lines.forEach(c=>{var p=+t.font.slice(0,2),T=t.measureText(c).width,m=p*1.5,l,n;this.top?n=this.top+e:this.bottom&&(n=t.canvas.height-this.top-m+e),this.right?l=t.canvas.width-this.right-T:this.left&&(l=this.left),e+=m,t.fillText(c,l,n)})}},Wt=Ot;var Pt=class extends Array{constructor(){super(),this.pushHandlers=[]}onPush(t,e){this.pushHandlers.push(t),e&&this.forEach(t)}push(t){super.push(t),this.pushHandlers.forEach(e=>e(t))}cull(){this.forEach((t,e)=>{t&&t.deleted&&delete this[e]})}},Z=Pt;var re=Et(ne(),1),xt=class{constructor(t,e){this._camera=t,this._player=e,this._staticObjects=new Z,this._movingObjects=new Z,this._uiElements=new Z,this._mouseX=t.getCentreOfViewport(),this._mouseY=0,this._paused=!1,this._beforeCycleCallbacks=[],this._afterCycleCallbacks=[],this._gameLoop=new re.default,e.setMapPosition(0,0),e.setMapPositionTarget(0,-10),t.followSprite(e),this._gameLoop.on("20",this.cycle.bind(this)),this._gameLoop.on("20",this.draw.bind(this))}addStaticObject(t){this._staticObjects.push(t)}addStaticObjects(t){t.forEach(this.addStaticObject.bind(this))}addMovingObject(t,e){e&&this._staticObjects.onPush(c=>{c.data&&c.data.hitBehaviour[e]&&c.onHitting(t,c.data.hitBehaviour[e])},!0),this._movingObjects.push(t)}addUIElement(t){this._uiElements.push(t)}beforeCycle(t){this._beforeCycleCallbacks.push(t)}afterCycle(t){this._afterCycleCallbacks.push(t)}setMouseX(t){this._mouseX=t}setMouseY(t){this._mouseY=t}cycle(){this._beforeCycleCallbacks.forEach(e=>e());var t=this._camera.canvasPositionToMapPosition([this._mouseX,this._mouseY]);this._player.isJumping||this._player.setMapPositionTarget(t[0],t[1]),this._player.cycle(),this._movingObjects.forEach(e=>e.cycle(this._camera)),this._staticObjects.cull(),this._staticObjects.forEach(e=>{e.cycle&&e.cycle()}),this._uiElements.forEach(e=>{e.cycle&&e.cycle()}),this._afterCycleCallbacks.forEach(e=>e())}draw(){this._camera.clearRect(0,0,this._camera.canvas.width,this._camera.canvas.height),this._player.draw(this._camera),this._player.cycle(),this._movingObjects.forEach(t=>t.draw(this._camera)),this._staticObjects.forEach(t=>{t.draw&&t.draw(this._camera,"main")}),this._uiElements.forEach(t=>{t.draw&&t.draw(this._camera,"main")})}start(){this._gameLoop.start()}pause(){this._paused=!0,this._gameLoop.stop()}isPaused(){return this._paused}reset(){this._paused=!1,this._staticObjects=new Z,this._movingObjects=new Z,this._mouseX=this._camera.getCentreOfViewport(),this._mouseY=0,this._player.reset(),this._player.setMapPosition(0,0,0),this.start()}},se=xt;var W={skier:{$imageFile:"sprite-characters.png",parts:{blank:[0,0,0,0],east:[0,0,24,34],esEast:[24,0,24,34],sEast:[49,0,17,34],south:[65,0,17,34],sWest:[49,37,17,34],wsWest:[24,37,24,34],west:[0,37,24,34],hit:[0,78,31,31],jumping:[84,0,32,34],somersault1:[116,0,32,34],somersault2:[148,0,32,34]},hitBoxes:{0:[7,20,27,34]},id:"player",hitBehaviour:{}},smallTree:{$imageFile:"skifree-objects.png",parts:{main:[0,28,30,34]},hitBoxes:{0:[0,18,30,34]},hitBehaviour:{}},tallTree:{$imageFile:"skifree-objects.png",parts:{main:[95,66,32,64]},zIndexesOccupied:[0,1],hitBoxes:{0:[0,54,32,64],1:[0,10,32,54]},hitBehaviour:{}},thickSnow:{$imageFile:"skifree-objects.png",parts:{main:[143,53,43,10]},hitBehaviour:{}},rock:{$imageFile:"skifree-objects.png",parts:{main:[30,52,23,11]},hitBehaviour:{}},monster:{$imageFile:"sprite-characters.png",parts:{sEast1:[64,112,26,43],sEast2:[90,112,32,43],sWest1:[64,158,26,43],sWest2:[90,158,32,43],eating1:[122,112,34,43],eating2:[156,112,31,43],eating3:[187,112,31,43],eating4:[219,112,25,43],eating5:[243,112,26,43]},hitBehaviour:{}},jump:{$imageFile:"skifree-objects.png",parts:{main:[109,55,32,8]},hitBehaviour:{}},signStart:{$imageFile:"skifree-objects.png",parts:{main:[260,103,42,27]},hitBehaviour:{}},snowboarder:{$imageFile:"sprite-characters.png",parts:{sEast:[73,229,20,29],sWest:[95,228,26,30]},hitBehaviour:{}},emptyChairLift:{$imageFile:"skifree-objects.png",parts:{main:[92,136,26,30]},zIndexesOccupied:[1]}};function ke(u){u.deleteOnNextCycle()}W.monster.hitBehaviour.tree=ke;function ae(u,t){t.deleteOnNextCycle()}W.smallTree.hitBehaviour.monster=ae;W.tallTree.hitBehaviour.monster=ae;function oe(u,t){t.hasHitObstacle(u)}W.smallTree.hitBehaviour.skier=oe;W.tallTree.hitBehaviour.skier=oe;function He(u,t){t.hasHitObstacle(u)}W.rock.hitBehaviour.skier=He;function Ve(u,t){t.hasHitJump(u)}W.jump.hitBehaviour.skier=Ve;function Ye(u,t){t.hasHitObstacle(u)}W.snowboarder.hitBehaviour.skier=Ye;var H=W;var K=document.getElementById("skifree-canvas"),J=At.create(K.getContext("2d")),Ue=["sprite-characters.png","skifree-objects.png"],Rt="Use the mouse or WASD to control the player";Bt()&&(Rt="Tap or drag on the piste to control the player");var ut=0,We=2e3,j=5,ht=0,Ke=!1,ct={smallTree:4,tallTree:2,jump:1,thickSnow:1,rock:1};localStorage.getItem("highScore")&&(ht=localStorage.getItem("highScore"));function qe(u,t){var e=0,c={};function p(){e+=1,e===u.length&&t(c)}u.forEach(function(T){var m=new Image;m.onload=p,m.src=T,J.storeLoadedImage(T,m)})}function Ge(u,t){t.isEatenBy(u,function(){j-=1,u.isFull=!0,u.isEating=!1,t.isBeingEaten=!1,u.setSpeed(t.getSpeed()),u.stopFollowing();var e=J.getRandomMapPositionAboveViewport();u.setMapPositionTarget(e[0],e[1])})}function Je(){var u,t,e,c;function p(){ut=0,j=5,ht=localStorage.getItem("highScore"),c.reset(),c.addStaticObject(t)}function T(){c.isPaused()||(ht=localStorage.setItem("highScore",ut),e.setLines(["Game over!","Hit space to restart"]),c.pause(),c.cycle())}function m(s,f){var v=Math.max(800-K.width,0);Math.floor(Math.random()*(1001+v))<=f&&s()}function l(){var s=new Ht(H.monster),f=J.getRandomMapPositionAboveViewport();s.setMapPosition(f[0],f[1]),s.follow(u),s.setSpeed(u.getStandardSpeed()),s.onHitting(u,Ge),c.addMovingObject(s,"monster")}function n(){var s=new Vt(H.snowboarder),f=J.getRandomMapPositionAboveViewport(),v=J.getRandomMapPositionBelowViewport();s.setMapPosition(f[0],f[1]),s.setMapPositionTarget(v[0],v[1]),s.onHitting(u,H.snowboarder.hitBehaviour.skier),c.addMovingObject(s)}u=new Ut(H.skier),u.setMapPosition(0,0),u.setMapPositionTarget(0,-10),Ke&&u.setHitObstacleCb(function(){j-=1}),c=new se(J,u),t=new U(H.signStart),c.addStaticObject(t),t.setMapPosition(-50,0),e=new Wt({initialLines:["SkiFree.js",Rt,"Travelled 0m","High Score: "+ht,"Skiers left: "+j,"Created by Dan Hough (@basicallydan)"],position:{top:15,right:10}}),c.beforeCycle(function(){var s=[];u.isMoving&&(s=U.createObjects([{sprite:H.smallTree,dropRate:ct.smallTree},{sprite:H.tallTree,dropRate:ct.tallTree},{sprite:H.jump,dropRate:ct.jump},{sprite:H.thickSnow,dropRate:ct.thickSnow},{sprite:H.rock,dropRate:ct.rock}],{rateModifier:Math.max(800-K.width,0),position:function(){return J.getRandomMapPositionBelowViewport()},player:u})),c.isPaused()||(c.addStaticObjects(s),m(n,.1),ut=parseFloat(u.getPixelsTravelledDownMountain()/18).toFixed(1),ut>We&&m(l,.001),e.setLines(["SkiFree.js",Rt,"Travelled "+ut+"m","Skiers left: "+j,"High Score: "+ht,"Created by Dan Hough (@basicallydan)","Current Speed: "+u.getSpeed()]))}),c.afterCycle(function(){j===0&&T()}),c.addUIElement(e),K.addEventListener("mousemove",function(s){c.setMouseX(s.pageX),c.setMouseY(s.pageY),u.resetDirection(),u.startMovingIfPossible()}),K.addEventListener("click",function(s){c.setMouseX(s.pageX),c.setMouseY(s.pageY),u.resetDirection(),u.startMovingIfPossible()}),K.focus(),Y.default.bind("f",u.speedBoost.bind(u)),Y.default.bind("t",u.attemptTrick.bind(u)),Y.default.bind(["w","up"],function(){u.stop()}),Y.default.bind(["a","left"],function(){u.direction===270?u.stepWest():u.turnWest()}),Y.default.bind(["s","down"],function(){u.setDirection(180),u.startMovingIfPossible()}),Y.default.bind(["d","right"],function(){u.direction===90?u.stepEast():u.turnEast()}),Y.default.bind("m",l),Y.default.bind("b",n),Y.default.bind("space",p),(0,ue.default)(K).on("press",function(s){s.preventDefault(),c.setMouseX(s.gesture.center.x),c.setMouseY(s.gesture.center.y)}).on("tap",function(s){c.setMouseX(s.gesture.center.x),c.setMouseY(s.gesture.center.y)}).on("pan",function(s){c.setMouseX(s.gesture.center.x),c.setMouseY(s.gesture.center.y),u.resetDirection(),u.startMovingIfPossible()}).on("doubletap",function(){u.speedBoost()}),u.isMoving=!1,u.setDirection(270),c.start()}function ce(){K.width=window.innerWidth,K.height=window.innerHeight}window.addEventListener("resize",ce,!1);ce();qe(Ue,Je);})();
/*! Bundled license information:

hammerjs/hammer.js:
  (*! Hammer.JS - v1.0.7dev - 2014-02-18
   * http://eightmedia.github.com/hammer.js
   *
   * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
   * Licensed under the MIT license *)
*/
